!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.LivePhotos=e():t.LivePhotos=e()}(this,function(){return function(t){function e(o){if(i[o])return i[o].exports;var n=i[o]={exports:{},id:o,loaded:!1};return t[o].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){function o(t,e){if(d){u&&n(),"object"==typeof t&&"[object Object]"===t.toString()&&(e=t,t=e.elements,delete e.elements),t||(t="img[data-live-photo]"),"string"==typeof t&&(t=document.querySelectorAll(t)),t instanceof HTMLElement&&(t=[t]);var i=[];return Array.prototype.forEach.call(t,function(t){if("string"==typeof t&&(t=document.querySelector(t)),t){var o=new l(t,e);i.push(o)}}),i}}function n(){h.use(),p++}function s(){u=!1}function r(){for(;p>0;)h.unuse(),p--}function a(t,e){return o(t,e)}var l=i(1),h=i(2),d=!0,p=0,u=!0;a.initialize=o,a.addStyles=n,a.noStyles=s,a.cleanup=r,a.LivePhoto=l,t.exports=a},function(t,e){function i(t,e,i,o){var n=document.createElement("video");return n.src=t+(i?"#"+i:""),n.controls=!1,n.setAttribute("playsinline","playsinline"),n.playsInline=!0,n.muted=o||!1,n.preload="auto",e&&(n.className=e),n}function o(t,e){if(t.paused){var i=t.muted,o=t.currentTime,n=function(){t.removeEventListener("loadedmetadata",n),t.currentTime=o,e&&e(t)};t.muted=!0,t.play(),t.pause(),t.muted=i,t.duration>=0?n():t.addEventListener("loadedmetadata",n)}}function n(t,e,o){var n=document.createElement("div");n.className="live-photo",n.setAttribute("data-live-photo","");var s=document.createElement("img");s.className="live-photo-keyframe",s.src=t;var r=i(e,"live-photo-postroll",o,!0),a=i(e,"live-photo-video"),l=document.createElement("i");return l.className="live-photo-icon",n.appendChild(s),n.appendChild(r),n.appendChild(a),n.appendChild(l),{container:n,img:s,postroll:r,video:a,icon:l}}function s(){var t=["mousedown"];return l&&t.push("touchstart"),t}function r(){var t=["mouseup","mouseout"];return l&&t.push("touchend"),t}function a(t,e,i,o){if(!(this instanceof a))return new a(t,e,i,o);var s,r;if(t instanceof HTMLElement&&(o=e,r=t,e=r.getAttribute("data-live-photo"),i=parseFloat(r.getAttribute("data-live-photo-still-image-time")),t=r.src),o||(o={}),this.postrollMs=o.postrollMs||375,this.deactivateMs=o.deactivateMs||500,this.previewMs=o.previewMs||500,this.stillImageTime=i||NaN,!t&&!o.noErrors)throw new Error("LivePhoto Error: Missing keyframeUrl");if(!e&&!o.noErrors)throw new Error("LivePhoto Error: Missing videoUrl");s=n(t,e,i),r&&(r.parentNode.insertBefore(s.container,r),r.parentNode.removeChild(r)),this.container=s.container,this.img=s.img,this.video=s.video,this.postroll=s.postroll,this.icon=s.icon,this.__onVideoCanPlayThrough=this._onVideoCanPlayThrough.bind(this),this.__onVideoLoadededMetadata=this._onVideoLoadededMetadata.bind(this),this.__onPostrollTimeUpdate=this._onPostrollTimeUpdate.bind(this),this.__startVideoPlayback=this._startVideoPlayback.bind(this),this.__startPostrollPlayback=this._startPostrollPlayback.bind(this),this.__resetPlayback=this._resetPlayback.bind(this),this.__resetPreview=this._resetPreview.bind(this),this.video.addEventListener("canplaythrough",this.__onVideoCanPlayThrough),this.video.duration?(this._setDuration(this.video.duration),this._resetPostroll()):(this._setDuration(0),this.video.addEventListener("loadedmetadata",this.__onVideoLoadededMetadata)),this._playing=!1,this._canPlayThrough=!1,this._playWhenReady=!1,o.useEventHandlers!==!1&&this._addEventHandlers(o.playEvents,o.stopEvents)}var l="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints;a.prototype={_addEventHandlers:function(t,e){var i=this.container,n=!1,a=this.play.bind(this),l=this.video,h=this.postroll,d=function(t){if(t.preventDefault(),n)a();else{var e=!1,i=!1;o(l,function(){e=!0,i&&a()}),o(h,function(){i=!0,e&&a()}),n=!0}};t&&t!==!1||(t=s),"function"==typeof t&&(t=t(this)),"string"==typeof t&&(t=t.split(/[,\s]+/)),t.forEach(function(t){t&&i.addEventListener(t,d)});var p=this.stop.bind(this),u=function(t){t.preventDefault(),p()};e&&e!==!1||(e=r),"function"==typeof e&&(e=e(this)),"string"==typeof e&&(e=e.split(/[,\s]+/)),e.forEach(function(t){t&&i.addEventListener(t,u)})},_onVideoCanPlayThrough:function(){this._canPlayThrough=!0,this._playWhenReady&&(this._playWhenReady=!1,this.play()),this.container.classList.remove("loading"),this.video.removeEventListener("canplaythrough",this.__onVideoCanPlayThrough)},_onVideoLoadededMetadata:function(){this._setDuration(this.video.duration||0),this._resetPostroll(),this.video.removeEventListener("loadedmetadata",this.__onVideoLoadededMetadata)},_onPostrollTimeUpdate:function(t){this.postroll.currentTime>=this.stillImageTime-.1&&this._resetPreview()},_clearTimeouts:function(){clearTimeout(this._resetVideoTimeout),clearTimeout(this._resetPostrollTimeout),clearTimeout(this._resetPreviewTimeout),this.postroll.removeEventListener("timeupdate",this.__onPostrollTimeUpdate)},_setDuration:function(t){this.duration=t,("number"!=typeof this.stillImageTime||isNaN(this.stillImageTime))&&(this.stillImageTime=.5*t),this.previewStart=Math.max(0,this.stillImageTime-this.previewMs/1e3)},_resetPostroll:function(){this.postroll.pause(),this.postroll.currentTime=this.stillImageTime},_resetVideo:function(){this.video.pause(),this.video.currentTime=0,this.video.muted=!1},_startVideoPlayback:function(){this.video.play(),this._resetPostroll()},_startPostrollPlayback:function(){this._resetPostroll(),this.postroll.play()},_resetPlayback:function(){this._playing=!1,this._resetVideo(),this._resetPostroll()},_resetPreview:function(){this.postroll.removeEventListener("timeupdate",this.__onPostrollTimeUpdate),this._resetPostroll(),this.container.classList.remove("preview")},load:function(){this.video.load(),this.postroll.load()},play:function(){if(!this._playing){if(!this._canPlayThrough)return this._playWhenReady=!0,this._clearTimeouts(),this.load(),void this.container.classList.add("loading");this._playing=!0,this._clearTimeouts(),this._startPostrollPlayback(),this.video.currentTime=0,this._resetPostrollTimeout=setTimeout(this.__startVideoPlayback,this.postrollMs),this.container.classList.add("active")}},stop:function(){this._playing&&(this.video.muted=!0,this._clearTimeouts(),this.container.classList.remove("active"),this._resetVideoTimeout=setTimeout(this.__resetPlayback,this.deactivateMs))},preview:function(){this._playing||(this._clearTimeouts(),this.postroll.currentTime=this.previewStart,this.postroll.play(),this.container.classList.add("preview"),this._previewCompleteTimeout=setTimeout(this.__resetPreview,1e3*(this.stillImageTime-this.previewStart)),this.postroll.addEventListener("timeupdate",this.__onPostrollTimeUpdate))}},t.exports=a},function(t,e,i){var o,n=0,s=i(3);"string"==typeof s&&(s=[[t.id,s,""]]),e.use=e.ref=function(){return n++||(e.locals=s.locals,o=i(5)(s,{})),e},e.unuse=e.unref=function(){--n||(o(),o=null)}},function(t,e,i){e=t.exports=i(4)(),e.push([t.id,".live-photo{position:relative;overflow:hidden;cursor:pointer}.live-photo img,.live-photo video{display:block;max-width:100%;pointer-events:none;-ms-touch-action:none;touch-action:none}.live-photo video{position:absolute;top:0;right:0;bottom:0;left:0;width:100%;height:100%}.live-photo video::-webkit-media-controls-start-playback-button{display:none}.live-photo .live-photo-icon{display:block;position:absolute;top:12px;left:12px;width:24px;height:24px;background:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='48' height='48' viewBox='0 0 48 48' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Ctitle%3ELive Photo%3C/title%3E%3Cg fill-rule='evenodd'%3E%3Cpath d='M24 36c6.627 0 12-5.373 12-12s-5.373-12-12-12-12 5.373-12 12 5.373 12 12 12zm0-2c5.523 0 10-4.477 10-10s-4.477-10-10-10-10 4.477-10 10 4.477 10 10 10z'/%3E%3Cpath d='M24 29a5 5 0 1 0 0-10 5 5 0 0 0 0 10zm0-3a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm0-19a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm4.788.63a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm4.462 1.85a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm3.831 2.94a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm2.94 3.831a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm1.849 4.462a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm.63 4.788a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-.63 4.788a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-1.85 4.461a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-2.94 3.831a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-3.831 2.94a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-4.462 1.849a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zM24 44a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-4.788-.63a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-4.462-1.85a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-3.831-2.94a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-2.94-3.831a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zM6.13 30.288a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zM5.5 25.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm.63-4.788a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm1.85-4.462a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm2.94-3.831a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm3.831-2.94a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm4.462-1.849a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z'/%3E%3C/g%3E%3C/svg%3E\") 50%;background-size:contain;filter:drop-shadow(0 1px 1px rgba(0,0,0,.5));pointer-events:none}.live-photo .live-photo-postroll,.live-photo .live-photo-video{opacity:0}.live-photo .live-photo-video{filter:blur(7.5px)}.live-photo .live-photo-keyframe,.live-photo .live-photo-postroll,.live-photo .live-photo-video{will-change:transform,filter,opacity;transition:transform .5s ease-out,filter .5s linear,opacity .5s linear}.live-photo.loading .live-photo-icon{animation:live-photo-icon-loading .5s linear alternate infinite both}.live-photo.preview .live-photo-postroll{opacity:1;transition-duration:0s}.live-photo.active img,.live-photo.active video{transform:scale(1.075)}.live-photo.active .live-photo-postroll{animation:live-photo-post-roll 1s both}.live-photo.active .live-photo-video{opacity:1;filter:none;transition-delay:.375s;transition-duration:.625s}@keyframes live-photo-icon-loading{0%{opacity:1}to{opacity:.75}}@keyframes live-photo-post-roll{0%{opacity:0;filter:blur(0)}2%{opacity:1}37.5%{opacity:1;filter:blur(7.5px)}to{opacity:0}}",""])},function(t,e){t.exports=function(){var t=[];return t.toString=function(){for(var t=[],e=0;e<this.length;e++){var i=this[e];i[2]?t.push("@media "+i[2]+"{"+i[1]+"}"):t.push(i[1])}return t.join("")},t.i=function(e,i){"string"==typeof e&&(e=[[null,e,""]]);for(var o={},n=0;n<this.length;n++){var s=this[n][0];"number"==typeof s&&(o[s]=!0)}for(n=0;n<e.length;n++){var r=e[n];"number"==typeof r[0]&&o[r[0]]||(i&&!r[2]?r[2]=i:i&&(r[2]="("+r[2]+") and ("+i+")"),t.push(r))}},t}},function(t,e,i){function o(t,e){for(var i=0;i<t.length;i++){var o=t[i],n=c[o.id];if(n){n.refs++;for(var s=0;s<n.parts.length;s++)n.parts[s](o.parts[s]);for(;s<o.parts.length;s++)n.parts.push(h(o.parts[s],e))}else{for(var r=[],s=0;s<o.parts.length;s++)r.push(h(o.parts[s],e));c[o.id]={id:o.id,refs:1,parts:r}}}}function n(t){for(var e=[],i={},o=0;o<t.length;o++){var n=t[o],s=n[0],r=n[1],a=n[2],l=n[3],h={css:r,media:a,sourceMap:l};i[s]?i[s].parts.push(h):e.push(i[s]={id:s,parts:[h]})}return e}function s(t,e){var i=m(),o=_[_.length-1];if("top"===t.insertAt)o?o.nextSibling?i.insertBefore(e,o.nextSibling):i.appendChild(e):i.insertBefore(e,i.firstChild),_.push(e);else{if("bottom"!==t.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");i.appendChild(e)}}function r(t){t.parentNode.removeChild(t);var e=_.indexOf(t);e>=0&&_.splice(e,1)}function a(t){var e=document.createElement("style");return e.type="text/css",s(t,e),e}function l(t){var e=document.createElement("link");return e.rel="stylesheet",s(t,e),e}function h(t,e){var i,o,n;if(e.singleton){var s=g++;i=y||(y=a(e)),o=d.bind(null,i,s,!1),n=d.bind(null,i,s,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=l(e),o=u.bind(null,i),n=function(){r(i),i.href&&URL.revokeObjectURL(i.href)}):(i=a(e),o=p.bind(null,i),n=function(){r(i)});return o(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;o(t=e)}else n()}}function d(t,e,i,o){var n=i?"":o.css;if(t.styleSheet)t.styleSheet.cssText=b(e,n);else{var s=document.createTextNode(n),r=t.childNodes;r[e]&&t.removeChild(r[e]),r.length?t.insertBefore(s,r[e]):t.appendChild(s)}}function p(t,e){var i=e.css,o=e.media;if(o&&t.setAttribute("media",o),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}function u(t,e){var i=e.css,o=e.sourceMap;o&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var n=new Blob([i],{type:"text/css"}),s=t.href;t.href=URL.createObjectURL(n),s&&URL.revokeObjectURL(s)}var c={},v=function(t){var e;return function(){return"undefined"==typeof e&&(e=t.apply(this,arguments)),e}},f=v(function(){return/msie [6-9]\b/.test(self.navigator.userAgent.toLowerCase())}),m=v(function(){return document.head||document.getElementsByTagName("head")[0]}),y=null,g=0,_=[];t.exports=function(t,e){e=e||{},"undefined"==typeof e.singleton&&(e.singleton=f()),"undefined"==typeof e.insertAt&&(e.insertAt="bottom");var i=n(t);return o(i,e),function(t){for(var s=[],r=0;r<i.length;r++){var a=i[r],l=c[a.id];l.refs--,s.push(l)}if(t){var h=n(t);o(h,e)}for(var r=0;r<s.length;r++){var l=s[r];if(0===l.refs){for(var d=0;d<l.parts.length;d++)l.parts[d]();delete c[l.id]}}}};var b=function(){var t=[];return function(e,i){return t[e]=i,t.filter(Boolean).join("\n")}}()}])});